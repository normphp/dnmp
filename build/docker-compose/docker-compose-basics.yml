version: '3.3'
services:
  php-fpm:
    env_file:
      - .env
    image: ${PHP_FPM_IMAGE}
    ports:
      - "${PHP_FPM_PORTS}"
    container_name: ${PHP_FPM_NAME}
    networks:
     - ${PHP_FPM_NETWORKS}
    volumes:
      - /docker/normphp/dnmp/data/www/:/www/:rw
      - /docker/normphp/dnmp/data/php/php-basics.ini:/usr/local/etc/php/php.ini:ro
      - /docker/normphp/dnmp/data/php/php-fpm.conf:/usr/local/etc/php-fpm.conf:ro
      - /docker/normphp/dnmp/data/php/php-fpm.d/:/usr/local/etc/php-fpm.d/:ro
      - /docker/normphp/dnmp/data/logs/php-fpm:/var/log/php-fpm:rw
    restart: always
    command: php-fpm

  nginx:
    env_file:
      - env/nginx.env
    build: ${NGINX_FPM_IMAGE}
    depends_on:
      - php-fpm
    container_name: ${NGINX_FPM_NAME}
    networks:
     - ${NGINX_FPM_NETWORKS}
    volumes:
      - /docker/normphp/dnmp/data/nginx/conf/nginx.conf:/etc/nginx/nginx.conf:ro
      - /docker/normphp/dnmp/data/nginx/logs/:/var/log/nginx/:rw
      - /docker/normphp/dnmp/data/nginx/conf/:/etc/nginx/conf/:ro
      - /docker/normphp/dnmp/data/nginx/logs/:/wwwlogs/:rw
      - /docker/normphp/dnmp/data/www/:/www/:rw
    ports:
      - "${NGINX_PORTS_HTTP}"
      - "${NGINX_PORTS_HTTP2}"
      - "${NGINX_PORTS_HTTPS}"
    restart: always
    command: nginx -g 'daemon off;'
networks:
  dnmpNat: